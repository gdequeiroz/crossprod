Title: Brexit poll of polls
Date: 2016-06-07
Author: Duncan Garmonsway
Summary: Analysis of Brexit polls by visualisation and a linear model
Disqus_identifier: brexit
Tags: R

```{r brexit-pelican-conf, echo=FALSE}
knitr::opts_chunk$set(cache = TRUE)
knitr::opts_chunk$set(fig.path='figure/')
knitr::opts_chunk$set(fig.width =  12.2)
knitr::opts_chunk$set(fig.height = 6.9)
knitr::opts_chunk$set(out.width =  "960px")
knitr::opts_chunk$set(out.height = "540px")
knitr::opts_chunk$set(dev = 'Cairo_svg')
knitr::opts_chunk$set(warning = FALSE)
```

# Brexit poll of polls
## Data

I scraped the poll data from the [Financial times poll of
polls](https://ig.ft.com/sites/brexit-polling).  Their graph is this one:

![https://ig.ft.com/sites/brexit-polling](figure/brexit-ft-polls.png)

```{r brexit-download, include = FALSE}
library(magrittr) # for set_colnames
library(rvest)
library(readr) # for write_csv, read_csv and parse_number
library(dplyr)
library(lubridate)
library(ggplot2)
library(scales)

theme_set(theme_grey() + 
          theme(panel.background = element_blank(),
                legend.key = element_blank()))

# If downloading:
# polls <- 
#   read_html("https://ig.ft.com/sites/brexit-polling/") %>% 
#   html_table %>% 
#     .[[1]]
# write_csv(polls, "./data/brexit.csv")

# If loading from disk
polls <- read_csv("./data/brexit.csv") # copes with commas inside quotes, via parse_number

master <- 
  polls %>%
  tbl_df %>%
  set_colnames(c("remain", "leave", "undecided", "date", "pollster", "sample")) %>%
  mutate(date = mdy(date),
         sample = parse_number(sample),
         sample_size = c("< 1400", "≥ 1400")[(sample > 1400 | (sample == 0 & pollster == "YouGov")) + 1]) %>%
  mutate_each(funs(./100), remain, leave, undecided) %>% # percentage
  rowwise %>%
  mutate(majority = c("remain", "leave")[which.max(c(remain, leave))],
         max_percent = max(remain, leave),
         min_percent = min(remain, leave))
```

## Small vs large samples

I classify samples as small if they are less than 1400.  My reasoning is
explained in due course.

I count YouGov polls with unknown sample sizes as large, since all but three
of the known sample sizes are above 1400.
## Timeseries

The FT emphasises their poll-of-polls statistic, and the difference between
online and telephone polls, whereas I emphasise the outcomes, the sizes of
the majorities, and the sample sizes.

Something happened in May 2013 and Oct/Nov 2014.  Anyone know what?

I don''t mark whether polls were conducted over the telephone or via the
internet, because the Financial Times table doesn't provide that
information.  A pity, since it's
[important](https://yougov.co.uk/news/2016/02/23/commentary-what-explains-difference-between-phone-):
> There’s a big difference between the online and telephone polls on the EU
referendum – with online polls showing the sides neck-and neck and
telephone polls showing about a 15% gap in favour of ‘remain’. Why?

```{r brexit-timeseries1}
master %>% 
  ggplot(aes(x = date, colour = majority)) +
  geom_linerange(aes(
                   ymax = max_percent, ymin = min_percent,
                   group = interaction(date, pollster),
                   linetype = sample_size)) +
  geom_point(aes(y = undecided, shape = sample_size)) +
  scale_x_date(date_breaks = "6 month", date_minor_breaks = "1 month",
               limits = c(ymd("2010-07-01"), NA), 
               expand = c(0, 0), labels = date_format("%b %Y")) +
  scale_fill_manual(values = c("darkgrey", NA), name = "Sample size") +
  scale_shape_manual(name = "Sample size", values = c(1, 19)) +
  scale_linetype_discrete(name = "Sample size") +
  scale_colour_manual(values = c("red", "forestgreen"), name = "Majority") +
  scale_y_continuous(labels = percent) +
  xlab("") +
  ylab("Majority/minority/undecided %") +
  ggtitle("Polls by date: Majority and its margin (lines), and undecided % (points)")
```

Here's that graph again, but beginning in September 2015 like the Financial
Times.  The leave majorities are mostly small samples.  I now suspect that
sample size is a proxy for telephone (large) vs online (small) polling.
I'll explore the 'zero undecided' polls (five points at the bottom of the
graph) at the end.

```{r brexit-timeseries2}
master %>% 
  filter(date >= ymd("2015-09-01")) %>%
  ggplot(aes(x = date, colour = majority)) +
  geom_linerange(aes(
                   ymax = max_percent, ymin = min_percent,
                   group = interaction(date, pollster),
                   linetype = sample_size)) +
  geom_point(aes(y = undecided, shape = sample_size)) +
  scale_x_date(date_breaks = "1 month", 
               limits = c(ymd("2015-09-01"), NA), 
               expand = c(0, 0), labels = date_format("%b %Y")) +
  scale_fill_manual(values = c("darkgrey", NA), name = "Sample size") +
  scale_shape_manual(name = "Sample size", values = c(1, 19)) +
  scale_linetype_discrete(name = "Sample size") +
  scale_colour_manual(values = c("red", "forestgreen"), name = "Majority") +
  scale_y_continuous(labels = percent) +
  xlab("") +
  ylab("Majority/minority/undecided %") +
  ggtitle("Polls by date: Majority and its margin (lines), and undecided % (points)")
```

## Outcome by sample size / polling method

Hardly any large-sample/telephone polls have a leave outcome.

```{r brexit-outcome-by-sample-size}
master %>%
  ggplot(aes(majority, fill = majority)) +
  scale_fill_manual(values = c("darkred", "darkgreen"), name = "Majority") +
  geom_bar() +
  annotate("text", "leave",  4, label = "Leave", colour = "white") +
  annotate("text", "remain",  4, label = "Remain", colour = "white") +
  xlab("") +
  ylab("Number of polls") +
  facet_wrap(~sample_size, labeller=labeller(sample_size = c("< 1400" = "Sample size < 1400", "≥ 1400" = "Sample size ≥ 1400"))) +
  ggtitle("Number of polls by majority") +
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
  theme(legend.position = "none")
```

## Justification of large/small threshold

Smaller samples don't find the 'leave' voters.

```{r brexit-remain-by-sample-size}
master %>% 
  filter(sample > 0) %>%
  ggplot(aes(sample, remain)) +
  geom_point(aes(colour = majority, shape = sample_size)) +
  geom_smooth(se = FALSE, colour = "black") +
  geom_vline(xintercept = 1400, linetype = 2) +
  annotate("text", 1350, 0.24, hjust = 1, label = "1400") +
  scale_colour_manual(values = c("red", "forestgreen"), name = "Majority") +
  scale_shape_manual(name = "Sample size", values = c(1, 19)) +
  scale_x_log10() +
  scale_y_continuous(labels = percent) +
  annotation_logticks(sides = "b") +
  xlab("Sample size (log scale)") +
  ylab("Remain %") +
  ggtitle("Remain % vs sample size")
```

Smaller samples don't find the undecided people (not as convincing as the
graph above).

```{r brexit-undecided-by-sample-size}
master %>%
  filter(sample > 0) %>%
  ggplot(aes(sample, undecided)) +
  geom_point(aes(colour = majority, shape = sample_size)) +
  geom_smooth(se = FALSE, colour = "black") +
  geom_vline(xintercept = 1400, linetype = 2) +
  annotate("text", 1350, 0.01, hjust = 1, label = "1400") +
  scale_x_log10() +
  scale_y_continuous(labels = percent) +
  scale_colour_manual(values = c("red", "forestgreen"), name = "Majority") +
  scale_shape_manual(name = "Sample size", values = c(1, 19)) +
  annotation_logticks(sides = "b") +
  xlab("Sample size (log scale)") +
  ylab("Undecided %") +
  ggtitle("Undecided % vs sample size")
```

## Indecision favours a 'leave' outcome: Part I -- graph

Here I can use stats, the only stats I've ever been taught (the really
out-of-date stuff), to explore whether undecided voters will favour the
status quo.  (What is my status quo -- that we're in Europe now, or that I've always
wanted to leave?)

Here's the association between indecision and the 'remain' vote.

```{r brexit-indecision-by-remain}
master %>%
  ggplot(aes(undecided, remain)) + 
  geom_point(aes(colour = majority, shape = sample_size)) +
  geom_abline(intercept = 0.5, slope = -1/2, linetype = 2) +
  scale_x_continuous(labels = percent) +
  scale_y_continuous(labels = percent) +
  scale_colour_manual(values = c("red", "forestgreen"), name = "Majority") +
  scale_shape_manual(name = "Sample size", values = c(1, 19)) +
  facet_wrap(~sample_size, labeller=labeller(sample_size = c("< 1400" = "Sample size < 1400", "≥ 1400" = "Sample size ≥ 1400"))) +
  xlab("Undecided %") +
  ylab("Remain %") +
  ggtitle("Remain % vs undecided %")
```

## Intermission (glitch)

A few 'remain' majorities are below the 'win' threshold in the graph above
(green points below the dotted line).  That could be because of missing
"won't vote" information.  See YouGov's
[explanation](https://yougov.co.uk/news/2016/02/23/commentary-what-explains-difference-between-phone-):
> Telephone polls ask their respondents “How will you vote in the
> referendum?” People are assumed to have an opinion, and 90% of them give 
> one. By contrast, online polls present people with options: remain, leave,
> won’t vote, don’t know – there is less assumption of an opinion, and 20% or
> more don’t offer one.
A few polls total much less than 100%, probably for the same reason, but it
isn't a problem in most cases.

```{r brexit-totals}
master %>%
  mutate(total = remain + leave + undecided) %>%
  ggplot(aes(total)) +
  geom_histogram(bins = 30) +
  scale_x_continuous(labels = percent) +
  xlab("Remain + leave + undecided %") +
  ylab("") +
  ggtitle("Distribution of each poll's total (should be about 100%)")
```

## Indecision favours a 'leave' outcome: Part II -- stats
We've already seen the non-linearity of sample size vs everything, so I build
two models, first for large samples, then for small ones.

```{r breixit-lm_large}
lm_large <- lm(remain ~ undecided, data = master %>% filter(sample_size == "≥ 1400"))
summary(lm_large)
```

The coefficient of 'undecided' is nearly -0.5, suggesting that undecided
large-sample voters about as likely to vote either way (lines almost
parallel).  But as proportion of undecided voters reduces, at what point does
the 'remain' outcome start to benefit?  (this analysis will be more
meaningful for small samples, in just a moment).

There are two linear functions: the fitted model, and the threshold of a
majority (depending on the proportion of voters who are undecided).  Not only
can we plot these functions (and base R is simplest here), but we can solve
them for the fulcrum, which turns out to be about 19%.  If the proportion of
voters who are undecided is below 19%, then outcome is likely to be 'remain'.

I exhibit the R code here, for anyone interested in plotting functions and
solving them.

```{r brexit-fulcrum-large, echo = TRUE}
remain <- function(x) {coef(lm_large)[2] * x + coef(lm_large)[1]}
majority <- function(x) {(1 - x) / 2}
plot(remain, 0, 0.5, xlab = "undecided", col = "blue")
plot(majority, 0, 0.5, col = "brown", add = TRUE)
fulcrum <- function(x) {remain(x) - majority(x)}
uniroot(fulcrum, interval = c(0, 1))$root
master %>% filter(sample_size == "≥ 1400", undecided >= 0.1855785) %>% nrow
```

Since "small" may be a proxy for "online", let's model that, too.

```{r brexit-lm-small}
lm_small <- lm(remain ~ undecided, data = master %>% filter(sample_size == "< 1400"))
summary(lm_small)
```

This time, the coefficient of undecided is about -0.8, suggesting that
undecided small-sample voters are more likely to vote to remain.  The fulrum,
now much more meaningful than above, given the coefficient, is at about 26%,
with a caveat that there are only five observations above 26%.

```{r brexit-fulcrum-small, echo = TRUE}
remain <- function(x) {coef(lm_small)[2] * x + coef(lm_small)[1]}
majority <- function(x) {(1 - x) / 2}
plot(remain, 0, 0.5, xlab = "undecided", col = "blue")
plot(majority, 0, 0.5, col = "brown", add = TRUE)
fulcrum <- function(x) {remain(x) - majority(x)}
uniroot(fulcrum, interval = c(0, 1))$root
master %>% filter(sample_size == "< 1400", undecided >= 0.255461) %>% nrow
```

## Zero undecided voters
It turns out that all the zero-undecided polls are by the ORB company, and
they're also the large-sample polls by ORB.  Make of that what you will.

```{r brexit-zero-undecided}
master %>% filter(undecided == 0)
master %>% 
  filter(pollster == "ORB") %>% 
  ggplot(aes(date, undecided, shape = sample_size, colour = majority)) +
  geom_point() +
  scale_y_continuous(labels = percent) +
  scale_x_date(date_breaks = "1 month", labels = date_format("%b %Y")) +
  scale_colour_manual(values = c("red", "forestgreen"), name = "Majority") +
  scale_shape_manual(name = "Sample size", values = c(1, 19)) +
  xlab("") +
  ylab("Undecided %") +
  ggtitle("ORB polls: sample size vs undecided % by date")
```

