<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Duncan Garmonsway" />
        <meta name="copyright" content="Duncan Garmonsway" />

        <meta name="description" content="Harry Potter cliches and story arcs by n-grams and sentiment analysis
" />
        <meta name="twitter:creator" content="@nacnudus">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="R, text, Harry Potter, Miscellaneous, " />

<meta property="og:title" content="Harry Potter and the N-Grams of Sentiment "/>
<meta property="og:url" content="http://nacnudus.github.io/crossprod/harry-potter-and-the-n-grams-of-sentiment" />
<meta property="og:description" content="Harry Potter cliches and story arcs by n-grams and sentiment analysis" />
<meta property="og:site_name" content="Crossprod" />
<meta property="og:article:author" content="Duncan Garmonsway" />
<meta property="og:article:published_time" content="2016-07-13T00:00:00+12:00" />
<meta name="twitter:title" content="Harry Potter and the N-Grams of Sentiment ">
<meta name="twitter:description" content="Harry Potter cliches and story arcs by n-grams and sentiment analysis">
<meta property="og:image" content="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-152x152.png" />
<meta name="twitter:image" content="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-152x152.png" >

        <title>Harry Potter and the N-Grams of Sentiment  · Crossprod
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" href="http://nacnudus.github.io/crossprod/theme/css/style.min.css?2f9bb2f8">
        <link rel="shortcut icon" href="http://nacnudus.github.io/crossprod/theme/images/favicon.ico" type="image/x-icon" type="image/png" />
        <link rel="icon" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link href="http://nacnudus.github.io/crossprod/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Crossprod - Full Atom Feed" />
        <link href="http://nacnudus.github.io/crossprod/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Crossprod - Full RSS Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-45097885-3', 'auto');
    ga('send', 'pageview');
</script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://nacnudus.github.io/crossprod/"><span class=site-name>Crossprod</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://nacnudus.github.io/crossprod">Home</a></li>
                            <li ><a href="http://nacnudus.github.io/crossprod/categories.html">Categories</a></li>
                            <li ><a href="http://nacnudus.github.io/crossprod/tags.html">Tags</a></li>
                            <li ><a href="http://nacnudus.github.io/crossprod/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://nacnudus.github.io/crossprod/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://nacnudus.github.io/crossprod/harry-potter-and-the-n-grams-of-sentiment"> <i>Harry Potter</i> and the N-Grams of&nbsp;Sentiment  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <p>This post applies <a href="http://juliasilge.com/blog/">Julia Silge</a>&#8216;s amazing story-arc
<a href="http://juliasilge.com/blog/Life-Changing-Magic/">sentiment</a>
<a href="http://juliasilge.com/blog/Life-Changing-Magic/">analyses</a> to the <em>Harry
Potter</em>&nbsp;books.</p>
<p>It also busts the myth that &#8220;turned on his heel&#8221; is the series&#8217; most common&nbsp;phrase.</p>
<p>Here is a related <a href="https://duncan-garmonsway.shinyapps.io/harry-potter">shiny
app</a> to explore the ideas&nbsp;futher.</p>
<h2 id="super-easy-text-munging">Super-easy&nbsp;text-munging</h2>
<p>Casual text-munging is no longer a pain, thanks to a couple of new packages,
<a href="https://github.com/juliasilge/tidytext">tidytext</a> and
<a href="https://github.com/lmullen/tokenizers">tokenizers</a>, and a not-so-new one,
<a href="https://github.com/gagolews/stringi">stringi</a>.</p>
<p>When I last analysed Harry Potter a few years ago, the
<a href="https://cran.r-project.org/web/packages/tm/index.html">tm</a> package, though
powerful, was frustrating, partly due to its unusual data format, which was
tricky to traverse.  But these new packages operate on ordinary data frames,
using nesting to great&nbsp;effect.</p>
<p>The outcome is that n-grams can be created incredibly quickly, easily avoiding
sentence boundaries.  The code is as simple as&nbsp;this:</p>
<div class="highlight"><pre>books <span class="o">%&gt;%</span> <span class="c1"># One row per paragraph. Two columns: title and text</span>
  <span class="c1"># First, break into sentences so that ngrams don&#39;t cross sentence boundaries</span>
  group_by<span class="p">(</span>title<span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span>sentence <span class="o">=</span> <span class="kt">list</span><span class="p">(</span><span class="kp">unlist</span><span class="p">(</span>map<span class="p">(</span>text<span class="p">,</span> tokenize_sentences<span class="p">))))</span> <span class="o">%&gt;%</span>
  unnest <span class="o">%&gt;%</span>
  <span class="c1"># Then create 4-grams</span>
  group_by<span class="p">(</span>title<span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span>fourgram <span class="o">=</span> <span class="kt">list</span><span class="p">(</span><span class="kp">unlist</span><span class="p">(</span>tokenize_ngrams<span class="p">(</span>sentence<span class="p">,</span> n <span class="o">=</span> <span class="m">4</span><span class="p">))))</span> <span class="o">%&gt;%</span>
  unnest
</pre></div>


<h2 id="most-common-phrases-in-harry-potter">Most-common phrases in <em>Harry&nbsp;Potter</em></h2>
<p>Did you hear that the most common phrase in <em>Harry Potter</em> is &#8220;turned on his
heel&#8221;?  I can finally bust that myth.  It does appear quite often &#8212; 12 times at
most, if you include &#8216;turning&#8217; and &#8216;her&#8217;, but the most-common four-word phrase,
by <em>miles</em>, is &#8220;Harry, Ron and Hermione&#8221;.  Big&nbsp;surprise.</p>
<p><img src="http://nacnudus.github.io/crossprod/figure/harry-potter-sentiment-fourgrams-1.svg" title="plot of chunk harry-potter-sentiment-fourgrams" alt="plot of chunk harry-potter-sentiment-fourgrams" width="960px" height="540px" /></p>
<p>A few of these are predictable nouns (Defence Against the Dark Arts, the
Ministry of Magic, the Room of Requirement).  He Who Must Not Be Named makes it
into the top 40.  There are a bunch of phrases that describe where things are
(at the end of, etc.).  But the most intriguing phrase is &#8220;said Hermione in a&#8221;
&#8212; why is Hermione singled out by that&nbsp;construction?</p>
<p>There&#8217;s a <a href="https://duncan-garmonsway.shinyapps.io/harry-potter/#n-grams">shiny
app</a> to explore
lots more n-grams, from 2-grams to&nbsp;10-grams.</p>
<p><a href="http://www.slate.com/articles/arts/culturebox/2013/11/hunger_games_catching_fire_a_textual_analysis_of_suzanne_collins_novels.html?wpisrc=burger_bar">Slate</a>
did a similar analysis, though they looked at the most-common <em>sentences</em>,
comparing <em>Harry Potter</em> with <em>The Hunger Games</em> and the <em>Twilight</em>&nbsp;series.</p>
<p>They seem to have edited their list somewhat, since &#8220;He waited&#8221; appears only
three times, and &#8220;Something he didn&#8217;t have last time&#8221; only twice, while I find
that &#8220;Harry nodded&#8221; tops my list (of complete sentences) with 14 occurences,
one more than Slate&#8217;s top sentence, &#8220;Nothing&nbsp;happened.&#8221;</p>
<p>Here are my top 30, many of which are not complete&nbsp;sentences.</p>
<p><img src="http://nacnudus.github.io/crossprod/figure/harry-potter-sentiment-sentences-1.svg" title="plot of chunk harry-potter-sentiment-sentences" alt="plot of chunk harry-potter-sentiment-sentences" width="960px" height="540px" /></p>
<p>Part of the difficulty is that written English speech isn&#8217;t unambiguously
punctuated.  This has bugged me since primary school.  See what happens&nbsp;here.</p>
<div class="highlight"><pre>tokenize_sentences<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;&#39;Are you going?&#39; Harry asked.&quot;</span><span class="p">,</span>
                     <span class="s">&quot;Ron asked, &#39;Are you going?&#39; Harry shrugged.&quot;</span><span class="p">,</span>
                     <span class="s">&quot;&#39;You should go,&#39; Harry said&quot;</span><span class="p">,</span>
                     <span class="s">&quot;&#39;Go now.&#39; Harry went.&quot;</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre>## [[1]]
## [1] &quot;&#39;Are you going?&#39;&quot; &quot;Harry asked.&quot;    
## 
## [[2]]
## [1] &quot;Ron asked, &#39;Are you going?&#39;&quot; &quot;Harry shrugged.&quot;            
## 
## [[3]]
## [1] &quot;&#39;You should go,&#39; Harry said&quot;
## 
## [[4]]
## [1] &quot;&#39;Go now.&#39;&quot;   &quot;Harry went.&quot;
</pre></div>


<p>Were I king, I&#8217;d decree the following unambiguous&nbsp;style.</p>
<div class="highlight"><pre>tokenize_sentences<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;Ron asked, &#39;Are you going?&#39;. Harry shrugged.&quot;</span><span class="p">,</span>
                     <span class="s">&quot;&#39;You should go.&#39;, Harry said&quot;</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre>## [[1]]
## [1] &quot;Ron asked, &#39;Are you going?&#39;.&quot; &quot;Harry shrugged.&quot;             
## 
## [[2]]
## [1] &quot;&#39;You should go.&#39;, Harry said&quot;
</pre></div>


<h2 id="most-important-characters">Most-important&nbsp;characters</h2>
<p>If importance is proportional to mentions of first names, then Hermione and Ron
are not as equal as you might&nbsp;expect.</p>
<p><img src="http://nacnudus.github.io/crossprod/figure/harry-potter-sentiment-characters-1.svg" title="plot of chunk harry-potter-sentiment-characters" alt="plot of chunk harry-potter-sentiment-characters" width="960px" height="540px" /></p>
<h2 id="sentiment-driven-story-arcs">Sentiment-driven story&nbsp;arcs</h2>
<p>Ever since I read <a href="http://juliasilge.com/blog/">Julia Silge</a>&#8216;s amazing story-arc
<a href="http://juliasilge.com/blog/Life-Changing-Magic/">sentiment</a>
<a href="http://juliasilge.com/blog/Life-Changing-Magic/">analyses</a>, I wanted to apply
the method to the <em>Harry Potter</em>&nbsp;books.</p>
<p>There&#8217;s a <a href="https://duncan-garmonsway.shinyapps.io/harry-potter/#sentiment">shiny
app</a> to explore
this interactively, but here is a still for the&nbsp;blog.</p>
<p><img src="http://nacnudus.github.io/crossprod/figure/harry-potter-sentiment-arcarea-1.svg" title="plot of chunk harry-potter-sentiment-arcarea" alt="plot of chunk harry-potter-sentiment-arcarea" width="960px" height="540px" /></p>
<p>If there&#8217;s anything to interpret here, then it&#8217;s that the first three books
play the game &#8220;fortunately, unfortunately&#8221;, while the later books are a little
different, especially <em>Order of the Phoenix</em>, which is the grumpy&nbsp;one.</p>
<p>Perhaps the Fourier transform is too sensitive to a magic number that I call the
&#8216;wiggliness&#8217; parameter.  To see how sensitive, I calculated the arcs for
&#8216;wiggliness&#8217; values from 3 to 10, and described the range of the arcs with a
ribbon &#8212; a little like the standard-error-ribbon on a <code>geom_smooth</code>.  I think
the ribbons show a more reliable story arc, and reveal that narrow wobbles, of
the order of a chapter or so, are probably&nbsp;misleading.</p>
<p><img src="http://nacnudus.github.io/crossprod/figure/harry-potter-sentiment-ribbon-1.svg" title="plot of chunk harry-potter-sentiment-ribbon" alt="plot of chunk harry-potter-sentiment-ribbon" width="960px" height="540px" /></p>
<p>And to see where the &#8216;wiggliness = 3&#8217; arc lies in the range, I superimpose it as a&nbsp;line.</p>
<p><img src="http://nacnudus.github.io/crossprod/figure/harry-potter-sentiment-ribbon-arcline-1.svg" title="plot of chunk harry-potter-sentiment-ribbon-arcline" alt="plot of chunk harry-potter-sentiment-ribbon-arcline" width="960px" height="540px" /></p>
<p>The code is, as always, on <a href="https://github.com/nacnudus/crossprod">GitHub</a>, but
you need to supply your own copies of the&nbsp;books.</p>
            <section>
    <p id="post-share-links">
    Like this post? Subscribe with <a href="https://nacnudus.github.io/crossprod/feeds/all.rss.xml" title="RSS">RSS</a>. Share on:
    <a href="http://twitter.com/home?status=Harry%20Potter%20and%20the%20N-Grams%20of%C2%A0Sentiment%20http%3A//nacnudus.github.io/crossprod/harry-potter-and-the-n-grams-of-sentiment" target="_blank" title="Share on Twitter">Twitter</a>
    ❄
    <a href="http://www.facebook.com/sharer/sharer.php?u=http%3A//nacnudus.github.io/crossprod/harry-potter-and-the-n-grams-of-sentiment" target="_blank" title="Share on Facebook">Facebook</a>
    ❄
    <a href="https://plus.google.com/share?url=http%3A//nacnudus.github.io/crossprod/harry-potter-and-the-n-grams-of-sentiment" target="_blank" title="Share on Google Plus">Google+</a>
    ❄
    <a href="mailto:?subject=Harry%20Potter%20and%20the%20N-Grams%20of%C2%A0Sentiment&amp;body=http%3A//nacnudus.github.io/crossprod/harry-potter-and-the-n-grams-of-sentiment" target="_blank" title="Share via Email">Email</a>
    </p>
</section>

            <section>
<p id="comment-message">Please comment below </p>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                    data-disqus-identifier="harry-potter-sentiment"
                href="http://nacnudus.github.io/crossprod/harry-potter-and-the-n-grams-of-sentiment#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'crossprod';
        var disqus_identifier = 'harry-potter-sentiment';
    var disqus_url = 'http://nacnudus.github.io/crossprod/harry-potter-and-the-n-grams-of-sentiment';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                </div>
            </div>
        </div>
    </div>
</div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="http://nacnudus.github.io/crossprod/hacking-the-data-science-radar-with-data-science" title="Previous: Hacking the Data Science Radar with Data Science">Hacking the Data Science Radar with Data Science</a></li>
                <li class="next-article"><a href="http://nacnudus.github.io/crossprod/more-harry-potter-story-arcs-they-get-darker" title="Next: More Harry Potter story arcs (they get darker)">More Harry Potter story arcs (they get darker)</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2016-07-13T00:00:00+12:00">Jul 13, 2016</time>
            <h4>Category</h4>
            <a class="category-link" href="http://nacnudus.github.io/crossprod/categories.html#miscellaneous-ref">Miscellaneous</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://nacnudus.github.io/crossprod/tags.html#harry-potter-ref">Harry Potter
                    <span>2</span>
</a></li>
                <li><a href="http://nacnudus.github.io/crossprod/tags.html#r-ref">R
                    <span>11</span>
</a></li>
                <li><a href="http://nacnudus.github.io/crossprod/tags.html#text-ref">text
                    <span>2</span>
</a></li>
            </ul>
<h4>Social</h4>
    <a href="https://github.com/nacnudus" title="My Github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="https://twitter.com/nacnudus" title="My Twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="https://nz.linkedin.com/in/duncangarmonsway" title="My LinkedIn Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-linkedin sidebar-social-links"></i></a>
    <a href="https://nacnudus.github.io/crossprod/feeds/all.rss.xml" title="Subscribe in a reader" class="sidebar-social-links" target="_blank">
    <i class="fa fa-rss sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-subtitle"><span class="site-name">Crossprod</span> - R, data, and frustration</li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

            <script type="text/javascript">
var disqus_shortname = 'crossprod';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<script  language="javascript" type="text/javascript">
function uncollapse() {
    if (window.location.hash.match(/^#comment-\d+$/)) {
        $('#disqus_thread').collapse('show');
    }
}
</script>
<script type="text/javascript" language="JavaScript">
uncollapse();
window.onhashchange=function(){
    if (window.location.hash.match(/^#comment-\d+$/))
        window.location.reload(true);
}
</script>
<script>
$('#disqus_thread').on('shown', function () {
    var link = document.getElementsByClassName('accordion-toggle');
    var old_innerHTML = link[0].innerHTML;
    $(link[0]).fadeOut(500, function() {
        $(this).text('Click here to hide comments').fadeIn(500);
    });
    $('#disqus_thread').on('hidden', function () {
        $(link[0]).fadeOut(500, function() {
            $(this).text(old_innerHTML).fadeIn(500);
        });
    })
})
</script>


    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>